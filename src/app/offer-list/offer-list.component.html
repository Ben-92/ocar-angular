<h1>Filtrer les annonces</h1>

<!--filter form to select offers on some criteria-->
<form [formGroup]="filterForm" (ngSubmit)="onFilter(filterForm.value)">  
    
    <div class="filter-form">

            <div class="filter-form-elt">
              <label for="dpt-code">Département où se trouve le véhicule:</label>
              <input  type="text"
                      formControlName="dptCode"
                      size="3"
                      maxlength="2"
                      id="dpt-code">
            </div>
            <!--check error on field : 
              -when a user click on the field (touched) or modifies it (dirty)
               -or when the user submits the form  -->
            <div *ngIf="((filterForm.get('dptCode').errors && (filterForm.get('dptCode').touched || filterForm.get('dptCode').dirty))
                     || (isSubmitted && filterForm.get('dptCode').errors))">
                <div *ngIf="filterForm.get('dptCode').errors" class="error-effect-title">
                  La région doit être valide
                </div>
            </div>
            
            <!--displaying Brand choices retrieved from the service brand list-->
            <div class="filter-form-elt">
              <label>Marque:</label>
              <select formControlName="carBrand">
                <option value="">Sélectionner la Marque</option>
                <option value={{brand.name}} *ngFor="let brand of brandList">{{brand.name}}</option>
              </select>
            </div>
            <div *ngIf="((filterForm.get('carBrand').errors && (filterForm.get('carBrand').touched || filterForm.get('carBrand').dirty))
              || (isSubmitted && filterForm.get('carBrand').errors))">
              <div *ngIf="filterForm.get('carBrand').errors" class="error-effect-title">
                  La marque est obligatoire
              </div>
            </div>
        
            <div class="filter-form-elt">
              <label>Modèle:</label>
              <select formControlName="carModel">
                <option value={{model.name}} *ngFor="let model of modelList">{{model.name}}</option>
                <option value="">Sélectionner le modèle</option>
              </select>
            </div>
            <div *ngIf="((filterForm.get('carModel').errors && (filterForm.get('carModel').touched || filterForm.get('carModel').dirty))
              || (isSubmitted && filterForm.get('carModel').errors))">
              <div *ngIf="filterForm.get('carModel').errors" class="error-effect-title">
                Le modèle est obligatoire
              </div>
            </div>
        
        
            <div class="filter-form-elt">
              <label>Année du véhicule:</label>
              <select formControlName="year">
                <option value={{year.yearValue}} *ngFor="let year of yearList">{{year.yearValue}}</option>
                <option value="">Sélectionner l'année</option>
              </select>
            </div>
            <div *ngIf="((filterForm.get('year').errors && (filterForm.get('year').touched || filterForm.get('year').dirty))
              || (isSubmitted && filterForm.get('year').errors))">
                <div *ngIf="filterForm.get('year').errors" class="error-effect-title">
                   L'année du véhicule est obligatoire
                </div>
            </div>
        
            <p>Boite de vitesse :</p>
            <div class="filter-form-elt-radio">
        
              <input type="radio" id="manualChoice" formControlName="gearbox" value="Manuelle">
              <label for="manualChoice">Manuelle</label>
              
              <input type="radio" id="autoChoice" formControlName="gearbox" value="Automatique">
              <label for="autoChoice">Automatique</label>
            
            </div>
        
        
            <div class="filter-form-elt">
              <label for="lowest">Prix mini- euros: </label>
              <input  type="text" 
                      formControlName="lowestPrice"
                      size="5"
                      maxlength="6"
                      id="lowest">
            </div>
            <div *ngIf="((filterForm.get('lowestPrice').errors && (filterForm.get('lowestPrice').touched || filterForm.get('lowestPrice').dirty))
            || (isSubmitted && filterForm.get('lowestPrice').errors))">
              <div *ngIf="filterForm.get('lowestPrice').errors" class="error-effect-title">
                Le prix doit être numérique et entier sans virgule
              </div>
            </div>

            <div class="filter-form-elt">
              <label for="highest">Prix maxi- euros: </label>
              <input  type="text" 
                      formControlName="highestPrice"
                      size="5"
                      maxlength="6"
                      id="highest">
            </div>
            <div *ngIf="((filterForm.get('highestPrice').errors && (filterForm.get('highestPrice').touched || filterForm.get('highestPrice').dirty))
            || (isSubmitted && filterForm.get('highestPrice').errors))">
              <div *ngIf="filterForm.get('highestPrice').errors" class="error-effect-title">
                Le prix doit être numérique et entier sans virgule
              </div>
            </div>

        
            <div class="filter-form-elt">
                <button class="submit-button" type="submit">Filtrer les annonces</button> 
            </div>
        
          </div>

</form>

<!--displaying specific message if no offer retrieved-->
<h2 *ngIf="contentTotalOffers > 0 ; else noOffer">{{contentTotalOffers}} annonce{{singularPluralChar}} !</h2>
<ng-template #noOffer><h2>Aucune annonce</h2></ng-template>

<!--displaying sort choices-->
<div class="sort-nb-offer-choices">
  <div *ngIf="contentTotalOffers > 0" class="sort-choice">
    <label>Afficher en premier : </label>
    <select #sortChoice (change)="onSortSelectChange(sortChoice.value)">
    <!--<option value="">Critère de tri</option> -->
    <option value="dateDESC">Annonces récentes</option>
    <option value="dateASC">Annonces anciennes</option>
    <option value="yearDESC">Véhicules récents</option>
    <option value="yearASC">Véhicules anciens</option>
    <option value="priceDESC">les + chères</option>
    <option value="priceASC">les - chères</option>
    </select>
  </div>

  <!--displaying number of offer per page choices-->
  <div *ngIf="contentTotalOffers > 0" class="nb-offers-choice">
    <label>Annonces par page : </label>
    <select #offersPerPageChoice (change)="onNbOffersPerPageChange(offersPerPageChoice.value)">
    <option value="3">3</option>
    <option value="5">5</option>
    <option value="10">10</option>
    <option value="15">15</option>
    <option value="20">20</option>
    </select>
  </div>
</div>

<!--displaying list of offers retrieved from database-->
<div id="offer-list">

      <div class="offer-list-result" *ngFor="let offer of pageContent">
        <div class="offer-list-text">
            <h3>Date de l'offre: {{offer.date | date : 'dd/MM/yyyy'}}</h3>
            
            <h3>Marque: {{offer.carBrand}}</h3>
            <h3>Modèle: {{offer.carModel}}</h3>
            <h3>Prix: {{offer.price | currency:'EUR':'symbol':'1.0-0'}}</h3>
        </div>
        <div class="offer-list-link">
            <h3><a [routerLink]="['offerDetail', offer.id]">Consulter</a></h3>
        </div>
        <div class="offer-list-image" *ngIf="offer.images[0]; else noPhoto"> 
            <img class="image-showcase" src="data:image/jpeg;base64,{{offer.images[0].picByte}}"> 
        </div>
        
        <ng-template #noPhoto>
            <div class="offer-list-image">
                <img class="image-showcase" src="https://img.autoplus.fr/news/2020/01/28/1545980/dd93e16662b77b72595ac6e8-1200-800.jpg" alt="offer-image">
            </div>
        </ng-template>
        
    </div>
</div>

  <!--Pagination menu-->
  <ul *ngIf="contentTotalOffers > 0" class="pagination-items-list">
      <li class="pagination-item">
        <a [ngClass]="{'is-disable': isFirstPage}" href=# (click)="displayPaginationPage(0)">Première page</a>
      </li>
      <li class="pagination-item">
        <a [ngClass]="{'is-disable': isFirstPage}" href=# (click)="displayPaginationPage(actualPageNumber - 1)">Page précédente</a>
      </li>
      <li class="pagination-item">Page {{actualPageNumber + 1}}/{{contentTotalPages}}</li>
      <li class="pagination-item">
        <a [ngClass]="{'is-disable': isLastPage}" href=# (click)="displayPaginationPage(actualPageNumber + 1)">Page suivante</a>
      </li>
  </ul>


